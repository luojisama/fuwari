---
import { getCollection } from "astro:content";
import Markdown from "@components/misc/Markdown.astro";
import MainGridLayout from "@layouts/MainGridLayout.astro";

export async function getStaticPaths() {
	const productEntries = await getCollection("products");
	return productEntries.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const rankColors: Record<string, string> = {
	S: "bg-red-500 text-white",
	A: "bg-orange-500 text-white",
	B: "bg-yellow-500 text-black",
	C: "bg-green-500 text-white",
	D: "bg-blue-500 text-white",
};
---

<MainGridLayout title={entry.data.title} description={entry.data.description}>
  <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative mb-4">
    <div class="card-base z-10 px-6 md:px-9 pt-6 pb-6 relative w-full">
        <div class="flex flex-col md:flex-row gap-8 items-start mb-8 border-b border-black/5 dark:border-white/5 pb-8">
             {entry.data.image && (
                <div class="w-full md:w-48 h-48 shrink-0 rounded-xl overflow-hidden shadow-lg bg-black/5 dark:bg-white/5 relative group">
                    <img src={entry.data.image} alt={entry.data.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                    <div class={`absolute top-2 right-2 px-3 py-1 rounded-lg font-bold shadow-md ${rankColors[entry.data.rank] || "bg-gray-500 text-white"}`}>
                        {entry.data.rank}
                    </div>
                </div>
            )}
            <div class="flex flex-col gap-4 flex-1">
                <h1 class="text-3xl md:text-4xl font-bold text-[var(--primary)]">{entry.data.title}</h1>
                <div class="text-lg text-75 italic border-l-4 border-[var(--primary)] pl-4 py-1 bg-[var(--primary)]/5 rounded-r-lg">
                    {entry.data.description}
                </div>
                {entry.data.reason && (
                    <div class="mt-auto">
                        <div class="text-sm font-bold text-50 mb-1 uppercase tracking-wider">评级理由</div>
                        <div class="bg-black/5 dark:bg-white/5 p-3 rounded-lg text-sm text-75">
                            {entry.data.reason}
                        </div>
                    </div>
                )}
            </div>
        </div>

        <Markdown class="mt-2">
            <Content />
        </Markdown>
    </div>
  </div>
</MainGridLayout>
